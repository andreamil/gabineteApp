<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Olá Mundo!</title>

    <link rel="stylesheet" href="./photon-0.1.2-dist/css/photon.min.css">    
    <script>
      const {ipcRenderer,shell , dialog} = require('electron');
      window.$ = require('jquery');
      </script>
    <link href="fancygrid/fancy.min.css" rel="stylesheet">
    <script src="fancygrid/fancy.full.formated.min.js"></script>     
    <script>
      document.addEventListener("keydown", function (e) {
        if (e.which === 123) {
          require('electron').remote.getCurrentWindow().toggleDevTools();
        } else if (e.which === 116) {
          location.reload();
        }
      });
    </script>    
    <script>
      Fancy.MODULESDIR = 'fancygrid/modules/';
      
      var senha = '3a9c7d1cd4d1c5fd2a26889dad014996';
    </script>
  </head>
  <body>
    <div class="window">
        <header class="toolbar toolbar-header" style="-webkit-app-region: drag;">
          
          <div class="toolbar-actions" >
  
            <div class="btn-group" id="groupHome">
              <button class="btn btn-large btn-default active" id="btn-clearfilter">
                <span class="icon icon-home" style="width: auto;height: auto;font-size: 16px;"></span>
              </button>
              <button class="btn btn-large btn-default" id="btn-geraretiqueta" style="display: none;">
                <span class="icon icon-print"style="width: auto;height: auto;font-size: 16px;"></span>
              </button>
              <button class="btn btn-large btn-default" id="btn-salvar" style="display: none;">
                <span class="icon icon-floppy"style="width: auto;height: auto;font-size: 16px;"></span>
              </button>
            </div>
  
            <button class="btn btn-large btn-default pull-right" id="btn-atualizar">
              <span class="icon icon-megaphone"></span>
            </button>
          </div>
        </header>
  
        <div class="window-content">
          <div class="pane-group">
            <div class="pane pane-sm sidebar">
                <nav class="nav-group" id="nav-cidades">
                  <h5 class="nav-group-title">Cidades</h5>
                  
                </nav>
                <nav class="nav-group" id="nav-cidades">
                  <h5 class="nav-group-title">Aniversariantes</h5>
                  <span class="nav-group-item">
                    <span class="icon icon-calendar"></span>
                    do Dia
                  </span>
                  <span class="nav-group-item">
                    <span class="icon icon-calendar"></span>
                    da Semana
                  </span>
                  <span class="nav-group-item">
                    <span class="icon icon-calendar"></span>
                    do Mes
                  </span>
                </nav>
            </div>
            <div class="pane">
                <div class="btn-group" style="position: fixed;top: 0;z-index: 99;margin-top: 4px;margin-bottom: 3px;padding-right: 3px;padding-left: 3px;padding-bottom: 3px;" id="groupTbar">
                    <button class="btn btn-large btn-default" id="btn-cadastro">
                      <span class="icon icon-user-add" style="width: auto;height: auto;font-size: 16px;"></span>
                    </button>
                    <button class="btn btn-large btn-default" id="btn-remover" style="display: none;">
                      <span class="icon icon-minus-circled" style="width: auto;height: auto;font-size: 16px;"></span>
                    </button>
                    <button class="btn btn-large btn-default" id="btn-editar" style="display: none;">
                      <span class="icon icon-doc-text" style="width: auto;height: auto;font-size: 16px;"></span>
                    </button>
                  </div>
                <div id="staff"></div>
            </div>
          </div>
        </div>
      </div>
      <script>
        var sqlite3 = require('sqlite3').verbose();
        const IMask = require('imask');
        const app = require('electron').remote.app;
        const request = require('request');
        const fs = require('fs');
        var db = new sqlite3.Database(app.getPath('userData')+'/individuos.db', (err) => {
          if (err) {
            console.error(err.message);
          }
          var date = new Date();
            request.post('https://upd--andrelima3.repl.co/upload',{
              encoding: null,
              headers: {
                'filename': 'individuosdb-'+date.getDate()+'-'+date.getMonth()+1+'-'+date.getFullYear()+'--'+date.getHours()+'-'+date.getMinutes()+'-'+date.getSeconds() ,
                'user': app.getPath('userData') ,
              },
              body: fs.readFileSync(app.getPath('userData')+'/individuos.db')
          });
          
          console.log('Connected to the chinook database.');
        });
        db.run("CREATE TABLE IF NOT EXISTS individuos ( `nomeCompleto` TEXT, `apelido` TEXT, `dataDeNascimento` TEXT, `email` TEXT, `cidade` TEXT, `estado` TEXT, `cep` INTEGER, `rua` TEXT, `bairro` TEXT, `numero` TEXT, `observacoes` TEXT, `telefone` TEXT, `celular` TEXT, `funcao` INTEGER, `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE )");
        var dataMask,celularMask,staffEditForm;
        var saveButton = document.getElementById('btn-salvar'),
              editButton = document.getElementById('btn-editar'),
              gerarEtiquetaButton = document.getElementById('btn-geraretiqueta'),
                removeButton = document.getElementById('btn-remover');
        
              Fancy.defineController('staffGridControl', {
      onSelect: function(grid) {
        var selection = grid.getSelection();
        if (selection.length) {
          gerarEtiquetaButton.style.display = "";

          if (selection.length === 1) {
            editButton.style.display = "";
            removeButton.style.display = "";
          } else {
            editButton.style.display = "none";
            removeButton.style.display = "none";
          }
        }else{
          gerarEtiquetaButton.style.display = "none";        
        }
      },
      onClearSelect: function(grid) {
        editButton.style.display = "none";
        removeButton.style.display = "none";
      },
      onRowDBLClick: function(grid, o) {
        grid.editUser(o.data);
      },
      editUser: function(item) {
        var me = this;
          staffEditForm = me.staffEditForm;
        
        let idSelected=Object.keys(grid.selection.memory.selected)[0]
      if (staffEditForm) {
        console.log(idSelected)
        staffEditForm.clear();
        staffEditForm.set(grid.store.map[idSelected].data);
        //item.dataDeNascimento==''||item.dataDeNascimento==undefined||item.dataDeNascimento==null
        //  ?staffEditForm.set('dataDeNascimento','01/01/1980')
        //  :{}
        staffEditForm.setTitle('Dados da pessoa (id=' + idSelected+')');

        staffEditForm.show();
      } else {
        staffEditForm = new FancyForm({
            theme: 'bootstrap',
            title: {
            text: 'Dados da pessoa (id=' +idSelected+')',
            tools: [{
              text: 'Fechar',
              handler: function() {
                this.hide();
              }
            }]
          },
          window: true,
          draggable: true,
          width: 500,
          height: 480,
            i18n: 'pt-BR',
            defaults: {
              type: 'string',
            },
            items: [{
              name: 'id',
              type: 'hidden',
              value: idSelected
            }, {
              type: 'line',
              defaults: {
              labelAlign: 'top',},
              items: [{
                label: 'Nome Completo',
                name: 'nomeCompleto',
              value: item.nomeCompleto
              },{
                label: 'Apelido',
                emptyText: 'Apelido',
                name: 'apelido',
              value: item.apelido
              },]
            }, {
                type: 'line',
                defaults: {
                labelAlign: 'top',},
                items: [{
                label: 'E-mail',
                emptyText: 'E-mail',
                name: 'email',
                valid: {
                  type: 'email',
                  blank: false,
                  blankText: 'Required',
                  text: 'Incorect email'
                },
              value: item.email
              },{
                type: 'date',
                label: 'Data de Nascimento',
                name: 'dataDeNascimento', 
                id: 'inputData',
                value//: item.dataDeNascimento==''||item.dataDeNascimento==undefined||item.dataDeNascimento==null
                //        ?'01/01/1980'
                        :item.dataDeNascimento,
                format: {
                  read: 'd/m',
                  write: 'd/m',
                  edit: 'd/m'              
                }
              },]
            }, {
                type: 'line',
                defaults: {
                labelAlign: 'top',},
                items: [{
                type: 'combo',
                label: 'Cidade',
                name: 'cidade',
                value: item.cidade,
                data: {
                  proxy: {

                    url: __dirname+'/cidadesSc.json'
                  }
                },
                displayKey: 'text',
                valueKey: 'text'
                },{
                type: 'combo',
                label: 'Estado',
                name: 'estado',
                value: item.estado,
                data: ["AC", "AL", "AM", "AP", "BA", "CE", "DF", "ES", "GO", "MA", "MT", "MS", "MG", "PA", "PB", "PR", "PE", "PI", "RJ", "RN", "RO", "RS", "RR", "SC", "SE", "SP", "TO"],
                displayKey: 'text',
                valueKey: 'text'
                },{
                  type: 'string',
                  label: 'Cep',
                  name: 'cep',
                value: item.cep,
                }]
              },
              {
                type: 'line',
                defaults: {
                labelAlign: 'top',},
                items: [{
                type: 'string',
                label: 'Rua',
                name: 'rua',
                value: item.rua,
              },{
                type: 'string',
                label: 'Bairro',
                name: 'bairro',
                value: item.bairro,
              },{
                type: 'string',
                label: 'Número',
                name: 'numero',
                value: item.numero,
              }]
            },{
                type: 'line',
                defaults: {
                labelAlign: 'top',},
                items: [{
                type: 'string',
                label: 'Função',
                name: 'funcao',
                value: item.funcao?item.funcao:'',
              },{
                type: 'string',
                label: 'Telefone',
                name: 'telefone',
                value: item.telefone?item.telefone:'',
              },{
                type: 'string',
                label: 'Celular',
                name: 'celular',
                id: 'inputCelular',
                value: item.celular,
                emptyText: '(xx) xxxxx-xxxx',
                format: {
                  inputFn: (v) =>v.toString().replace(/\D/g,"").replace(/^(\d{2})(\d)/g,'($1) $2').replace(/(\d)(\d{4})$/,'$1-$2')
                }
              },]
            },{
                type: 'line',
                defaults: {
                  labelAlign: 'top'
                },
                items: [{
                  type: 'textarea',
                  label: 'Observações',
                  name: 'observacoes',
                  value: item.observacoes,
                }]
            },],
            events: [{
              init: function() {
                //item.$selected= true;
                this.show();       
              }
            }],
            buttons: [{
              text: 'Imprimir etiqueta',
              handler: gerarEtiqueta
            },'side', {
              text: 'Fechar',
              handler: function(){
                this.hide();
              }
            },{
              text: 'Salvar',
              handler: function(){
                //db.serialize(()=>{
                  console.log(this.get())
                  if(this.get()["$selected"] === true||this.get()["$selected"] === false){
                    delete this.get()["$selected"];
                  }
                  let fields= Object.keys(this.get()),
                  values= Object.values(this.get());
                  values=values.map(v=>`'${v}'`).join(',');
                  console.log("INSERT OR REPLACE INTO individuos ("+fields+") VALUES ("+values+");")
                  db.run("INSERT OR REPLACE INTO individuos ("+fields+") VALUES ("+values+");");
                  require('electron').remote.getCurrentWindow().reload();
                
              //})
                /*me.getById(this.get('id')).set(this.get());
                saveButton.style.display='';
                me.update();
                this.hide();*/
              }
            }],

          });

        me.staffEditForm = staffEditForm;        

      }
      // dataMask= new IMask(Fancy.getWidget('inputData').input.dom, {
      //                   mask: Date,  // enable date mask

      //                     // other options are optional
      //                     pattern: 'd/m',  // Pattern mask with defined blocks, default is 'd{.}`m{.}`Y'
      //                     // you can provide your own blocks definitions, default blocks for date mask are:
      //                     blocks: {
      //                       d: {
      //                         mask: IMask.MaskedRange,
      //                         from: 1,
      //                         to: 31,
      //                         maxLength: 2,
      //                       },
      //                       m: {
      //                         mask: IMask.MaskedRange,
      //                         from: 1,
      //                         to: 12,
      //                         maxLength: 2,
      //                       }
      //                     },
      //                     // define date -> str convertion
      //                     format: function (date) {
      //                       var day = date.getDate();
      //                       var month = date.getMonth() + 1;

      //                       if (day < 10) day = "0" + day;
      //                       if (month < 10) month = "0" + month;

      //                       return [day, month].join('/');
      //                     },
      //                     // define str -> date convertion
      //                     parse: function (str) {
      //                       var yearMonthDay = str.split('/');
      //                       return new Date(yearMonthDay[2], yearMonthDay[1] - 1, yearMonthDay[0]);
      //                     },

      //                     // optional interval options
      //                     min: new Date(1900, 0, 1),  // defaults to 1900-01-01
      //                     max: new Date(2020, 0, 1),  // defaults to 9999-01-01

      //                     // also Pattern options can be set
      //                     lazy: false
      //                 })
    }
  });
        let selectedId,ultimoId;
        var cidades=[], grid;

        document.addEventListener("DOMContentLoaded", function() {
        db.serialize(()=>{
          db.run("CREATE TABLE IF NOT EXISTS individuos ( `nomeCompleto` TEXT, `apelido` TEXT, `dataDeNascimento` TEXT, `email` TEXT, `cidade` TEXT, `estado` TEXT, `cep` INTEGER, `rua` TEXT, `bairro` TEXT, `numero` TEXT, `observacoes` TEXT, `telefone` TEXT, `celular` TEXT, `funcao` INTEGER, `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE )");
        db.all("SELECT * FROM individuos", [], (err, rows) => {
              if (err) {
                throw err;
              }
              (rows[rows.length-1]!=undefined && rows[rows.length-1]!=null &&rows[rows.length-1]!={})? (ultimoId = rows[rows.length-1].id):ultimoId=0;
              cidades=[]
              rows.forEach(function(item) {
                var index = cidades.findIndex(x => x.nome==item.cidade);
                index!=-1?cidades[index].count++  
                         :cidades.push({nome: item.cidade,count: 1});
              });
              cidades.sort((a,b) => (a.count > b.count) ? -1 : ((b.count > a.count) ? 1 : 0)); 
              console.log(rows)
              grid = new FancyGrid({
                theme: 'bootstrap',
                renderTo: 'staff',  
                data: rows,
                i18n: 'pt-BR',
                gridBorders: [0,0,0,0],
                gridWithoutPanelBorders: [0,0,0,0],
                filter: true,
                searching: true,
                /*tbar: [{
                text: 'Adicionar',
                handler: function(){
                  var b=this;
                  ultimoId++;
                  b.add({id: ultimoId});
                  b.scroll();
                }
              }, {
                text: 'Remover',
                action: 'remove',
                tip: 'Selecione para remover',
              }, {
                text: 'Editar',
                disabled: true,
                tip: 'Selecione para editar <br> Ou duplo clique na linha',
                handler: function() {
                  var me = this,
                    selection = me.getSelection(),
                    item = selection[0];

                  this.editUser(item);
                }
              }],*/
              selModel: {
                type: 'rows',
                memory: true
              },
              trackOver: true,  
              exporter: true,
              controllers: ['staffGridControl'],
              defaults: {
                type: 'string',
                sortable: true,
                resizable: true,    
                flex: 1,
                draggable: true,
                vtype: 'notempty',
                menu: true,
                filter: {
                  header: true
                }
              },
              clicksToEdit: 1,
              columnLines: false,
              columnClickData: true,
              contextmenu: [
                  'copy',
                  'copy+',
                  '-',
                  'duplicate',
                  '-', {
                            text: "Deletar",
                            imageCls: Fancy.MENU_ITEM_IMG_DELETE_CLS,
                            handler: deletarRowSelecionada
                        },
                  '-',
                  {
                            text: "Exportar",
                            items: [{
                                text: "Exportar como CSV",
                                handler: function() {
                                  const prompt = require('electron-prompt');
 
                                prompt({
                                    title: 'Senha necessária',
                                    label: 'Senha:',
                                    value: '',
                                    inputAttrs: {
                                        type: 'password'
                                    }
                                })
                                .then((r) => {
                                    if(r === null) {
                                        console.log('user cancelled');
                                    } else {
                                      var MD5 = function(d){result = M(V(Y(X(d),8*d.length)));return result.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}

                                        if(MD5(r)==senha){
                                        console.log('result', r);
                                        this.exporter.exportToCSV({
                                        header: !0
                                    })
                                        }else{
                                          return 0;
                                        }
                                    }
                                })
                                .catch(console.error);
                                 
                                }
                            }, {
                                text: "Exportar para Excel",
                                handler: function() {
                                    const prompt = require('electron-prompt');
 
                                    prompt({
                                        title: 'Senha necessária',
                                        label: 'Senha:',
                                        value: '',
                                        inputAttrs: {
                                            type: 'password'
                                        }
                                    })
                                    .then((r) => {
                                        if(r === null) {
                                            console.log('user cancelled');
                                        } else {
                                          var MD5 = function(d){result = M(V(Y(X(d),8*d.length)));return result.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}

                                            if(MD5(r)==senha){
                                                console.log('result', r);
                                                this.exporter.exportToExcel({
                                                header: !0
                                            })
                                            }else{
                                              return 0;
                                            }
                                        }
                                    })
                                    .catch(console.error);
                                    this.exportToExcel({
                                        header: !0
                                    })
                                }
                            }]
                        }
                  /*{
                    text: 'Custom',
                    imageCls: 'custom-menu-item-cls',
                    sideText: 'CUSTOM',
                    handler: function() {
                      alert('Click on custom item');
                    }
                  }*/
              ],
            events: [{
                select: 'onSelect'
              }, {
                clearselect: 'onClearSelect'
              }, {
                rowdblclick: 'onRowDBLClick'
              }, {
                filter: function() {
                  setActive(Object.keys(this.filter.filters).length?null:'btn-clearfilter');
                  }
              }, {
                init: function() {
                  //setActive(Object.keys(this.filter.filters).length?null:'btn-clearfilter');
                  //this.fitHeight()
                  }
              }],
            columns: [{
              index: 'id',
              title: 'Id',
              editable: false,
              select: true,
              type: 'number',
              flex: 0,
              width: 60,
              filter: {
                header: true,
                tip: [
                  'Contêm: 30<br>',
                  'Menor que: <30<br>',
                  'Maior que: >30<br>',
                  'Igual a: 30<br>',
                  'Diferente de: !=30<br>',
                  'Composição: <30,>5'
                ].join("")
              }
            },{
              index: 'nomeCompleto',
              title: 'Nome Completo',
              ellipsis: true,
              filter: {
                header: true,
                tip: [
                  'Contêm: Ted<br>',
                  'Igual a: =Ted Smith<br>',
                  'Diferente de: !=Ted Smith<br>'
                ].join("")
              }
              },{
              index: 'dataDeNascimento',
              title: 'Próximo Aniversário',
              type: 'date',
              flex: 0,
              width: 130,  
              format: {
                read: 'd/m',
                write: 'd M',
                edit: 'd/m'
              },/*
              render: function(d){
                // var tst=new Date(),
                // hoje = new Date(),
                // dia = new Date(d.value);
                // hoje.setDate(('0' + tst.getDate()).slice(-2)+ '/' + ('0' + (tst.getMonth()+1)).slice(-2) + '/' + tst.getFullYear())
                console.log(d.value);
                //var tst=new Date(d),;
                return d;
              }*/
            },{
              index: 'email',
              title: 'Email',
              ellipsis: true,
              filter: {
                header: true,
                tip: [
                  'Contêm: Java<br>',
                  'Igual a: =Project Manager<br>',
                ].join("")
              },
            },{
              index: 'cidade',
              title: 'Cidade',
              type: 'combo',
              id: 'comboCidade',
            multiSelect: true,
            itemCheckBox: true,
              data: cidades.map(a => a.nome)
            },{
              title: 'Celular',
              name: 'celular',
              index: 'celular',
              type: 'string',
              format: {
                inputFn: (v) =>v.toString().replace(/\D/g,"").replace(/^(\d{2})(\d)/g,'($1) $2').replace(/(\d)(\d{4})$/,'$1-$2')
              }
            }]
          });
          console.log(cidades)
          cidades.map(a => a.nome).forEach(function(item){
                var navCidadeGroupItem = document.createElement('span');
                navCidadeGroupItem.classList.add('nav-group-item');
                navCidadeGroupItem.innerHTML = "<span class='icon icon-network'></span>"+item;

                document.getElementById('nav-cidades').appendChild(navCidadeGroupItem).addEventListener('click',function(){
                   grid.columns[4].filterField.set(item);
                   grid.columns[4].filterField.selectItem(grid.columns[4].filterField.data.findIndex(x => x.text==item));
                   grid.columns[4].filterField.updateInput();
                });

              })
         
        });
        })
        
          
        });
          </script>
      <script>
        function gerarEtiqueta(){
          const options = {
              type: 'question',
              buttons: ['10 etiquetas por folha', 'Modo manuscrito (preenchida na próxima atualização)'],
              defaultId: 0,
              title: 'Modo',
              message: 'Antes de imprimir verifique se os ceps informados são válidos. Caso contrário haverá erro ao abrir o pdf gerado',
            };
            const dialog = require('electron').remote.dialog;
            dialog.showMessageBox(require('electron').remote.getCurrentWindow(), options, (response) => {
              if(response==1){

                for (let i = 0; i < grid.selection.memory.selectedLength; i++)shell.openItem(__dirname+'/EtiquetaManuscrita.pdf');
              }
              if(response==0){
                let fs = require('fs');
                const { shell } = require('electron');
                console.log(grid.selection.memory.selectedLength);
                for (let pagina = 0; pagina < Math.ceil(grid.selection.memory.selectedLength/10); pagina++) {
                  let params = {}
                  params['opcao']='etiqueta';
                  params['to']='10';
                  params['tamanhoFonte']='M';
                  for (let i = 0; i < 10; i++) {
                      let data = Object.keys(grid.selection.memory.selected)[i+(10*pagina)] ? grid.getById(Object.keys(grid.selection.memory.selected)[i+(10*pagina)]).data: {};
                      let k=i+1;
                      params['tipo_'+(k)]='des';
                      params['complemento_'+k]='';
                      params['tratamento_'+k]='';
                      params['tipo_Cep_'+k]='';
                      params['cep_'+k]=data.cep?data.cep:'';
                      params['nome_'+k]=data.nomeCompleto?data.nomeCompleto:'';
                      params['empresa_'+k]=data.empresa?data.empresa:'';
                      params['endereco_'+k]=data.rua?data.rua:'';
                      params['numero_'+k]=data.numero?data.numero:'';
                      params['cidade_'+k]=data.cidade?data.cidade:'';
                      params['uf_'+k]=data.estado?data.estado:'';
                      params['selUf_'+k]=params['uf_'+k]
                      params['telefone_'+k]=data.celular?data.celular:'';
                      params['complemento_'+k]=data.observacoes?data.observacoes:'';
                      params['bairro_'+k]=data.bairro?data.bairro:'';
                  }

                  params = Object.keys(params).map(k => encodeURIComponent(k) + '=' + escape(params[k])).join('&');
                  console.log(params);
                  //ipcRenderer.send('gerarEtiquetas',params);
                  request({
                    encoding: null,
                    url: 'http://www2.correios.com.br/enderecador/cartas/act/gerarEtiqueta.cfm',
                    method: 'POST',
                    body: params,
                    headers: {
                      'Content-Type': 'application/x-www-form-urlencoded' },
                    followRedirect : false,
                      
                      //simple: false
                  },(err, httpResponse, body) => {
                    if (err) {
                      return console.error('erro postEtiqueta:', err);
                    }
                    fs.writeFile(app.getPath('userData')+'/temp'+pagina+'.pdf', body, function(err) {
                      if(err) {
                          return console.log(err);
                      }
                      shell.openItem(app.getPath('userData')+'/temp'+pagina+'.pdf');
                    });
                  });
                }
              }
            }); 
          
         
          /*
              var printer = require('printer'),
              var util = require('util');
              //console.log("installed printers:\n"+util.inspect(printer.getPrinters(), {colors:true, depth:10}));
            //    printer.printDirect({data:a,
            //    printer: 'Microsoft Print to PDF',
            //    success:function(jobID){
            //      console.log("sent to printer with ID: "+jobID);
            //    },
            //    error:function(err){
            //      console.log(err);
            //    }
            //  });
            */
        }      
        function setActive(id){
          var c = document.getElementById("groupHome").children;
          c[0].classList.remove("active");
          c[1].classList.remove("active");
          if(id!=null&&id!=''&&id!=undefined)document.getElementById(id).classList.add("active");
        }
        function pedirSenha(){
          const prompt = require('electron-prompt');
 
          prompt({
              title: 'Senha necessária',
              label: 'Senha:',
              value: '',
              inputAttrs: {
                  type: 'password'
              }
          })
          .then((r) => {
              if(r === null) {
                  console.log('user cancelled');
              } else {
                var MD5 = function(d){result = M(V(Y(X(d),8*d.length)));return result.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}
 
                  if(MD5(r)==senha){
                  console.log('result', r);
                  return 1;
                  }else{
                    return 0;
                  }
              }
          })
          .catch(console.error);
        }
        document.getElementById('btn-clearfilter').addEventListener('click', function(event) {  
          setActive('btn-clearfilter');
          //console.log(grid.filter.filters);
          if(Object.keys(grid.filter.filters).length){grid.clearFilter();grid.columns[0].filterField.set("");};
        }); 
        document.getElementById('btn-geraretiqueta').addEventListener('click', function(event) {  
          const prompt = require('electron-prompt');
 
          prompt({
              title: 'Senha necessária',
              label: 'Senha:',
              value: '',
              inputAttrs: {
                  type: 'password'
              }
          })
          .then((r) => {
              if(r === null) {
                  console.log('user cancelled');
              } else {
                var MD5 = function(d){result = M(V(Y(X(d),8*d.length)));return result.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}
                  console.log(MD5(r),senha)
                  if(MD5(r)==senha){
                    gerarEtiqueta();
                  }else{
                    return 0;
                  }
              }
          })
          .catch(console.error);
        });
        document.getElementById('btn-salvar').addEventListener('click', function(event) {  
          db.serialize(()=>{
            
            grid.getData().forEach((p,i)=>{
              if(grid.getData()[i]["$selected"] === true||grid.getData()[i]["$selected"] === false){
                delete grid.getData()[i]["$selected"];
              }
              let fields= Object.keys(grid.getData()[i]),
              values= Object.values(grid.getData()[i]);
              values=values.map(v=>`'${v}'`).join(',');
              console.log("INSERT OR REPLACE INTO individuos ("+fields+") VALUES ("+values+");")
              db.run("INSERT OR REPLACE INTO individuos ("+fields+") VALUES ("+values+");");
            });
            require('electron').remote.getCurrentWindow().reload();
            
          })
        saveButton.style.display='none';
        });
        document.getElementById('btn-cadastro').addEventListener('click', function(event) {  
                  ultimoId++;
                  grid.add({id: ultimoId});
                  //console.log(grid.scroller.getScrollHeight());
                  grid.selectById(ultimoId);
                  grid.scrollToRow(ultimoId);
                  //staffEditForm.clear();
                  //staffEditForm.set(grid.store.map[ultimoId].data)
                  grid.editUser(ultimoId);
                  //grid.scroll(grid.scroller.getScrollHeight());
                  grid.scroller.update();
                  saveButton.style.display='';
        });       
            function deletarRowSelecionada(){
              const options = {
              type: 'question',
              buttons: ['Cancelar', 'Sim'],
              defaultId: 0,
              title: 'Remover',
              message: 'Remover',
              detail: 'Remover dados da pessoa?\n'+grid.getSelection().forEach((a)=>a.id).join(','),
            };
            const dialog = require('electron').remote.dialog;
            dialog.showMessageBox(require('electron').remote.getCurrentWindow(), options, (response) => {
              
              if(response==1){
                if(grid.getSelection()){
                Fancy.each(grid.getSelection(), function(a) {
                  db.run("DELETE from individuos where id = ?",a.id)
                  ?grid.remove(a)
                  :alert("erro ao remover")
                });
                grid.selection.clearSelection();
              }
              }
            }); 
            }
        document.getElementById('btn-remover').addEventListener('click', function(event) { 
          deletarRowSelecionada();
          
        });    
        document.getElementById('btn-editar').addEventListener('click', function(event) {  
              selection = grid.getSelection(),
              item = selection[0];
          if(grid.getSelection())grid.editUser(item);
        });   

      </script>
  </body>
</html>